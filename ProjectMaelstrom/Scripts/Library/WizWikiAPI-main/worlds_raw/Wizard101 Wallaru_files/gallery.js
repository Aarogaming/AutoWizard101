"use strict";var ki_gallery={isInitialized:false,pageElements:null,lightbox:null,moreToggle:null,initialize:function(a){if(typeof ki==="undefined"){throw new Error("Unable to initialize ki_gallery without global ki library. Make sure global.js is being loaded correctly.")}if(this.hasValidSettings(a)){this.pageElements=this.getPageElements(a);this.rebindEvents();this.pageElements.thumbnails=this.hideInvalidThumbnails(this.pageElements.thumbnails);this.lightbox=Object.create(this.ki_lightbox);this.lightbox.initialize(a);this.lightbox.onRequestNextImage=this.lightbox_onRequestNextImage;this.lightbox.onRequestPreviousImage=this.lightbox_onRequestPreviousImage;this.lightbox.onImageLoaded=this.lightbox_onImageLoaded;this.moreToggle=Object.create(this.ki_moreToggle);this.moreToggle.initialize(a);this.addThumbnailEvents(this.pageElements.thumbnails);this.isInitialized=true}},hasValidSettings:function(a){var b=ki.verifyProperties(a,[{name:"thumbnailClassName",type:"string"},{name:"maxDefaultThumbnails",type:"number"},]);if(b.length>0){throw new Error("Unable to initialize ki_gallery because the following settings are missing: "+b)}return true},verifyIsInitialized:function(){if(!this.isInitialized){throw new Error("You must call initialize before this method will work.")}},getPageElements:function(a){ki.verifyFunctionArguments(arguments,["object"]);var b={thumbnailContainer:ki.getElementStartingWithId("",a.thumbnailContainerId),};b.thumbnails=b.thumbnailContainer.querySelectorAll("."+a.thumbnailClassName);if(!b.thumbnails||b.thumbnails.length===0){throw new Error("Unable to find any thumbnails with provided class name: "+a.thumbnailClassName)}return b},rebindEvents:function(){this.thumbnail_onClick=this.thumbnail_onClick.bind(this);this.lightbox_onRequestNextImage=this.lightbox_onRequestNextImage.bind(this);this.lightbox_onRequestPreviousImage=this.lightbox_onRequestPreviousImage.bind(this);this.lightbox_onImageLoaded=this.lightbox_onImageLoaded.bind(this)},hideInvalidThumbnails:function(c){ki.verifyFunctionArguments(arguments,["object"]);var b=[];for(var a=0;a<c.length;a++){if(!this.hasValidThumbnailSettings(c[a])){c[a].style.display="none";console.warn("Hiding thumbnail because it is missing essential attribute 'data-fullSrc'. Thumbnail src - "+c[a].src);continue}b.push(c[a])}return b},hasValidThumbnailSettings:function(b){ki.verifyFunctionArguments(arguments,["html"]);var a=b.dataset;if(!a){return false}if(!a.fullsrc){return false}return true},addThumbnailEvents:function(b){ki.verifyFunctionArguments(arguments,["array"]);for(var a=0;a<b.length;a++){b[a].addEventListener("click",this.thumbnail_onClick,{passive:true})}},getThumbnailIndex:function(c,b){ki.verifyFunctionArguments(arguments,["array","html"]);for(var a=0;a<c.length;a++){if(c[a]===b){return a}}console.warn("There were no thumbnail matches for - ",b);return 0},showAnotherImage:function(a,c){this.verifyIsInitialized();ki.verifyFunctionArguments(arguments,["number","function"]);var b=c(a,this.pageElements.thumbnails.length);this.lightbox.showAnother(this.pageElements.thumbnails[b].getAttribute("data-fullSrc"));this.lightbox.setCounterPosition(b,this.pageElements.thumbnails.length)},getNextCounter:function(a,b){ki.verifyFunctionArguments(arguments,["number","number"]);a++;if(a>b-1){a=0}return a},getPreviousCounter:function(a,b){ki.verifyFunctionArguments(arguments,["number","number"]);a--;if(a<0){a=b-1}return a},preloadAdjacentImages:function(b){this.verifyIsInitialized();ki.verifyFunctionArguments(arguments,["number"]);var a=this.pageElements.thumbnails.length;this.ki_imagePreload.preloadImage(this.pageElements.thumbnails[this.getNextCounter(b,a)].dataset.fullsrc);this.ki_imagePreload.preloadImage(this.pageElements.thumbnails[this.getPreviousCounter(b,a)].dataset.fullsrc)},thumbnail_onClick:function(b){this.verifyIsInitialized();this.lightbox.show(b.target.dataset.fullsrc);var a=this.getThumbnailIndex(this.pageElements.thumbnails,b.target);this.lightbox.setCounterPosition(a,this.pageElements.thumbnails.length)},lightbox_onRequestNextImage:function(a){this.showAnotherImage(a,this.getNextCounter)},lightbox_onRequestPreviousImage:function(a){this.showAnotherImage(a,this.getPreviousCounter)},lightbox_onImageLoaded:function(){this.preloadAdjacentImages(this.lightbox.currentCounter)},ki_moreToggle:{isInitialized:false,pageElements:null,fullSizeHeight:0,moreText:"",lessText:"",windowResizeTimeoutId:-1,initialize:function(a){if(typeof ki==="undefined"){throw new Error("Unable to initialize ki_gallery without global ki library. Make sure global.js is being loaded correctly.")}if(this.hasValidSettings(a)){this.pageElements=this.getPageElements(a);this.moreText=a.moreText;this.lessText=a.lessText;this.rebindEvents();this.fullSizeHeight=this.calculateFullHeight(this.pageElements.thumbnailContainer);this.addMoreButtonEvents(this.pageElements.moreButton);this.addWindowEvents();this.isInitialized=true}},hasValidSettings:function(a){var b=ki.verifyProperties(a,[{name:"moreText",type:"string"},{name:"lessText",type:"string"},{name:"thumbnailContainerId",type:"string"},{name:"moreContainerId",type:"string"},{name:"moreButtonId",type:"string"},]);if(b.length>0){throw new Error("Unable to initialize ki_gallery because the following settings are missing: "+b)}return true},verifyIsInitialized:function(){if(!this.isInitialized){throw new Error("You must call initialize before this method will work.")}},getPageElements:function(a){ki.verifyFunctionArguments(arguments,["object"]);var b={thumbnailContainer:ki.getElementStartingWithId("",a.thumbnailContainerId),moreContainer:ki.getElementStartingWithId("",a.moreContainerId),moreButton:ki.getElementStartingWithId("",a.moreButtonId),};return b},rebindEvents:function(){this.moreButton_click=this.moreButton_click.bind(this);this.window_resize=this.window_resize.bind(this);this.window_resizeTimeout=this.window_resizeTimeout.bind(this)},addMoreButtonEvents:function(a){ki.verifyFunctionArguments(arguments,["html"]);a.addEventListener("click",this.moreButton_click,{passive:true})},addWindowEvents:function(){window.addEventListener("resize",this.window_resize,{passive:true})},setExpandedDisplay:function(d,b,a,c){ki.verifyFunctionArguments(arguments,["html","html","number","string"]);d.style.height=a+"px";b.innerText=c},setContractedDisplay:function(c,a,b){ki.verifyFunctionArguments(arguments,["html","html","string"]);c.style.height="";a.innerText=b},isExpanded:function(a){ki.verifyFunctionArguments(arguments,["html"]);return a.style.height!==""},calculateFullHeight:function(c){ki.verifyFunctionArguments(arguments,["html"]);var b=c.style.height;c.style.height="auto";var a=c.getBoundingClientRect().height;c.style.height=b;return a},moreButton_click:function(a){this.verifyIsInitialized();if(this.isExpanded(this.pageElements.thumbnailContainer)){this.setContractedDisplay(this.pageElements.thumbnailContainer,this.pageElements.moreButton,this.moreText)}else{this.setExpandedDisplay(this.pageElements.thumbnailContainer,this.pageElements.moreButton,this.fullSizeHeight,this.lessText)}},window_resize:function(a){this.verifyIsInitialized();if(this.windowResizeTimeoutId>-1){clearTimeout(this.windowResizeTimeoutId)}this.windowResizeTimeoutId=setTimeout(this.window_resizeTimeout,100)},window_resizeTimeout:function(){this.verifyIsInitialized();var a=this.calculateFullHeight(this.pageElements.thumbnailContainer);if(a!==this.fullSizeHeight){this.fullSizeHeight=a;if(this.isExpanded(this.pageElements.thumbnailContainer)){this.setExpandedDisplay(this.pageElements.thumbnailContainer,this.pageElements.moreButton,this.fullSizeHeight,this.lessText)}}this.windowResizeTimeoutId=-1},},ki_lightbox:{isInitialized:false,loaderTimeoutId:-1,onRequestPreviousImage:null,onRequestNextImage:null,onImageLoaded:null,currentCounter:0,initialize:function(a){if(typeof ki==="undefined"){throw new Error("Unable to initialize ki_gallery without global ki library. Make sure global.js is being loaded correctly.")}if(this.hasValidSettings(a)){this.pageElements=this.getPageElements(a);this.rebindEvents();this.addCloseEvents(this.pageElements.closeButton,this.pageElements.background);this.addImageEvents(this.pageElements.lightboxImage);this.addNavigateButtonEvents(this.pageElements.nextButton,this.pageElements.previousButton);this.isInitialized=true}},hasValidSettings:function(a){var b=ki.verifyProperties(a,[{name:"lightboxId",type:"string"},{name:"lightboxCloseButtonId",type:"string"},{name:"lightboxImageId",type:"string"},{name:"lightboxBackgroundId",type:"string"},{name:"lightboxLoadingId",type:"string"},{name:"lightboxNextButtonId",type:"string"},{name:"lightboxPreviousButtonId",type:"string"},{name:"lightboxCurrentCounterId",type:"string"},{name:"lightboxTotalCounterId",type:"string"},]);if(b.length>0){throw new Error("Unable to initialize ki_gallery because the following settings are missing: "+b)}return true},verifyIsInitialized:function(){if(!this.isInitialized){throw new Error("You must call initialize before this method will work.")}},getPageElements:function(a){ki.verifyFunctionArguments(arguments,["object"]);var b={lightbox:ki.getElementStartingWithId("",a.lightboxId),closeButton:ki.getElementStartingWithId("",a.lightboxCloseButtonId),lightboxImage:ki.getElementStartingWithId("",a.lightboxImageId),background:ki.getElementStartingWithId("",a.lightboxBackgroundId),loader:ki.getElementStartingWithId("",a.lightboxLoadingId),nextButton:ki.getElementStartingWithId("",a.lightboxNextButtonId),previousButton:ki.getElementStartingWithId("",a.lightboxPreviousButtonId),currentCounterDisplay:ki.getElementStartingWithId("",a.lightboxCurrentCounterId),totalCounterDisplay:ki.getElementStartingWithId("",a.lightboxTotalCounterId),};return b},addCloseEvents:function(b,a){ki.verifyFunctionArguments(arguments,["html","html"]);b.addEventListener("click",this.closeButton_onClick,{passive:true});a.addEventListener("click",this.background_onClick,{passive:true})},addImageEvents:function(a){ki.verifyFunctionArguments(arguments,["html"]);a.addEventListener("load",this.image_load,{passive:true})},addNavigateButtonEvents:function(b,a){ki.verifyFunctionArguments(arguments,["html","html"]);b.addEventListener("click",this.nextButton_onClick,{passive:true});a.addEventListener("click",this.previousButton_onClick,{passive:true})},rebindEvents:function(){this.background_onClick=this.background_onClick.bind(this);this.closeButton_onClick=this.closeButton_onClick.bind(this);this.lightbox_closeTransitionEnd=this.lightbox_closeTransitionEnd.bind(this);this.image_load=this.image_load.bind(this);this.nextButton_onClick=this.nextButton_onClick.bind(this);this.previousButton_onClick=this.previousButton_onClick.bind(this)},setCounterPosition:function(a,b){this.verifyIsInitialized();ki.verifyFunctionArguments(arguments,["number","number"]);this.currentCounter=a;this.pageElements.currentCounterDisplay.innerText=(a+1).toString();this.pageElements.totalCounterDisplay.innerText=b.toString()},show:function(a){this.verifyIsInitialized();ki.verifyFunctionArguments(arguments,["string"]);this.showDelayedImageLoader();this.pageElements.lightboxImage.src=a;this.pageElements.lightbox.classList.remove("display-none");setTimeout(function(){this.pageElements.lightbox.classList.add("show-lightbox")}.bind(this),0)},showAnother:function(a){this.verifyIsInitialized();ki.verifyFunctionArguments(arguments,["string"]);this.showDelayedImageLoader();this.pageElements.lightboxImage.src=a},hide:function(){this.verifyIsInitialized();this.pageElements.lightbox.classList.remove("show-lightbox");this.pageElements.lightbox.addEventListener("transitionend",this.lightbox_closeTransitionEnd,{passive:true,once:true})},showDelayedImageLoader:function(){this.verifyIsInitialized();if(this.loaderTimeoutId>-1){clearTimeout(this.loaderTimeoutId)}this.loaderTimeoutId=setTimeout(function(){this.pageElements.loader.classList.remove("display-none");this.loaderTimeoutId=-1}.bind(this),100)},hideImageLoader:function(){this.verifyIsInitialized();if(this.loaderTimeoutId>-1){clearTimeout(this.loaderTimeoutId);this.loaderTimeoutId=-1}this.pageElements.loader.classList.add("display-none")},dispatchOnNextImageRequest:function(){this.verifyIsInitialized();if(typeof this.onRequestNextImage!=="function"){throw new Error("Unable to get previous image because onRequestNextImage has not been set to a function.")}this.onRequestNextImage(this.currentCounter)},dispatchOnPreviousImageRequest:function(){this.verifyIsInitialized();if(typeof this.onRequestPreviousImage!=="function"){throw new Error("Unable to get previous image because onRequestPreviousImage has not been set to a function.")}this.onRequestPreviousImage(this.currentCounter)},closeButton_onClick:function(a){this.hide()},background_onClick:function(a){this.hide()},lightbox_closeTransitionEnd:function(a){this.pageElements.lightbox.classList.add("display-none")},image_load:function(a){this.hideImageLoader();if(typeof this.onImageLoaded==="function"){this.onImageLoaded()}},nextButton_onClick:function(a){this.dispatchOnNextImageRequest()},previousButton_onClick:function(a){this.dispatchOnPreviousImageRequest()},},ki_imagePreload:{preloadedURLs:[],preloadImage:function(a){ki.verifyFunctionArguments(arguments,["string"]);if(!this.hasAlreadyPreloaded(a)){var b=document.createElement("img");b.src=a;this.preloadedURLs.push(a)}},hasAlreadyPreloaded:function(b){ki.verifyFunctionArguments(arguments,["string"]);for(var a=0;a<this.preloadedURLs.length;a++){if(this.preloadedURLs[a]===b){return true}}return false},},};