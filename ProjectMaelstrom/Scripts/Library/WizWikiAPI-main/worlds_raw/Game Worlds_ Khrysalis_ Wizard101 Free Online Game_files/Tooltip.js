var Tips,Tip;(function(b,a,c,d){Tips={tips:[],zIndex:1200,add:function(e){this.tips.push(e)},remove:function(e){var f=this.tips.find(function(g){return g.element==c(e)});if(!f){return}this.tips=this.tips.reject(function(g){return g==f});f.deactivate();if(f.tooltip){f.wrapper.remove()}if(f.underlay){f.underlay.remove()}}};Tip=Class.create();Tip.prototype={initialize:function(f,h){this.element=c(f);Tips.remove(this.element);var l=a.getElementById(h);if(l){this.content=l.innerHTML}else{this.content=h}this.options=Object.extend({className:"tap5c_tooltip",duration:0.3,effect:false,hook:false,offset:(arguments[2]&&arguments[2].hook)?{x:0,y:0}:{x:16,y:16},fixed:false,target:this.element,title:false,viewport:true,useMouseOver:true,width:"152",PositionOnWinResize:false,toggleMode:false},arguments[2]||{});this.target=c(this.options.target);if(this.options.hook){this.options.fixed=true;this.options.viewport=false}if(this.options.effect){this.queue={position:"end",limit:1,scope:""};var k="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";for(var e=0;e<6;e++){var g=Math.floor(Math.random()*k.length);this.queue.scope+=k.substring(g,g+1)}}if(this.options.PositionOnWinResize){var j=this;Event.observe(b,"resize",function(){var i=j.tooltip.parentNode;if(!i.style.display||i.style.display=="block"||i.style.display!="none"){var m=c(j.target).cumulativeOffset();i.style.left=m.left+j.options.offset.x;i.style.top=m.top+j.options.offset.y}})}this.buildWrapper();Tips.add(this);this.activate()},activate:function(){if(this.element){if(this.options.toggleMode){this.eventToggle=this.toggleTip.safeBind(this);this.element.observe("click",this.eventToggle)}this.eventShow=this.showTip.safeBind(this);this.eventHide=this.hideTip.safeBind(this);if(this.options.useMouseOver==true){this.element.observe("mousemove",this.eventShow);this.element.observe("mouseout",this.eventHide)}}},deactivate:function(){if(this.element){if(this.options.toggleMode){this.element.stopObserving("click",this.eventToggle)}if(this.options.useMouseOver==true){this.element.stopObserving("mousemove",this.eventShow);this.element.stopObserving("mouseout",this.eventHide)}}},buildWrapper:function(){this.wrapper=a.createElement("div");this.wrapper.className="tap5c_wrapper";Element.setStyle(this.wrapper,{position:"absolute",zIndex:Tips.zIndex+1,display:"none"});if(Prototype.Browser.IE6){this.underlay=a.createElement("iframe");this.underlay.src=staticJavaScriptRoot+"/themes/global/images/spacer.gif";Element.setStyle(this.underlay,{position:"absolute",display:"none",border:1,margin:0,opacity:0.01,padding:0,background:"none",zIndex:Tips.zIndex})}},buildTip:function(){if(Prototype.Browser.IE6){a.body.appendChild(this.underlay)}this.tooltip=this.wrapper.appendChild(a.createElement("div"));this.tooltip.className=this.options.className;this.tooltip.style.position="relative";this.tooltip.style.width=this.options.width+"px";if(this.options.toggleMode){this.tooltip.observe("dblclick",this.eventToggle)}if(this.options.title){this.title=this.tooltip.appendChild(a.createElement("div"));this.title.className="tap5c_tooltip-title";Element.update(this.title,this.options.title)}this.tip=this.tooltip.appendChild(a.createElement("div"));this.tip.className="tap5c_tooltip-content";Element.update(this.tip,this.content);a.body.appendChild(this.wrapper);var e=this.wrapper.getDimensions();this.wrapper.setStyle({width:this.options.width+"px",height:e.height+"px"});if(Prototype.Browser.IE6){this.underlay.setStyle({width:e.width+"px",height:e.height+"px"})}Element.hide(this.tooltip)},showTip:function(e){if(!this.tooltip){this.buildTip()}this.hideAllTips(e);this.positionTip(e);if(this.wrapper.visible()&&this.options.effect!="appear"){return}if(Prototype.Browser.IE6){this.underlay.show()}this.wrapper.show();if(!this.options.effect||Prototype.Browser.IE6){this.tooltip.show()}else{if(this.activeEffect){Effect.Queues.get(this.queue.scope).remove(this.activeEffect)}this.activeEffect=Effect[Effect.PAIRS[this.options.effect][0]](this.tooltip,{duration:this.options.duration,queue:this.queue})}},hideTip:function(e){if(!this.wrapper.visible()){return}if(!this.options.effect||Prototype.Browser.IE6){if(Prototype.Browser.IE){this.underlay.hide()}this.tooltip.hide();this.wrapper.hide()}else{if(this.activeEffect){Effect.Queues.get(this.queue.scope).remove(this.activeEffect)}this.activeEffect=Effect[Effect.PAIRS[this.options.effect][1]](this.tooltip,{duration:this.options.duration,queue:this.queue,afterFinish:function(){if(Prototype.Browser.IE6){this.underlay.hide()}this.wrapper.hide()}.bind(this)})}},toggleTip:function(e){if(this.wrapper.visible()){this.hideTip(e)}else{this.hideAllTips(e);this.showTip(e)}},hideAllTips:function(f){for(var e=0;e<Tips.tips.length;e++){Tips.tips[e].hideTip(f)}},positionTip:function(e){var i={"left":this.options.offset.x,"top":this.options.offset.y};var j=Position.cumulativeOffset(this.target);var f=this.wrapper.getDimensions();var m={"left":(this.options.fixed)?j[0]:Event.pointerX(e),"top":(this.options.fixed)?j[1]:Event.pointerY(e)};m.left+=i.left;m.top+=i.top;if(this.options.hook){var o={"target":this.target.getDimensions(),"tip":f};var p={"target":Position.cumulativeOffset(this.target),"tip":Position.cumulativeOffset(this.target)};for(var l in p){switch(this.options.hook[l]){case"topRight":p[l][0]+=o[l].width;break;case"bottomLeft":p[l][1]+=o[l].height;break;case"bottomRight":p[l][0]+=o[l].width;p[l][1]+=o[l].height;break}}m.left+=-1*(p.tip[0]-p.target[0]);m.top+=-1*(p.tip[1]-p.target[1])}if(!this.options.fixed&&this.element!==this.target){var g=Position.cumulativeOffset(this.element);m.left+=-1*(g[0]-j[0]);m.top+=-1*(g[1]-j[1])}if(!this.options.fixed&&this.options.viewport){var n=this.getScrollOffsets();var k=this.viewportSize();var h={"left":"width","top":"height"};for(var l in h){if((m[l]+f[h[l]]-n[l])>k[h[l]]){m[l]=m[l]-f[h[l]]-2*i[l]}if(m[l]<0){m[l]=0}}}this.wrapper.setStyle({left:m.left+"px",top:m.top+"px"});if(Prototype.Browser.IE6){this.underlay.setStyle({left:m.left+"px",top:m.top+"px"})}},viewportWidth:function(){if(Prototype.Browser.Opera){return a.body.clientWidth}return a.documentElement.clientWidth},viewportHeight:function(){if(Prototype.Browser.Opera){return a.body.clientHeight}if(Prototype.Browser.WebKit){return this.innerHeight}return a.documentElement.clientHeight},viewportSize:function(){return{"height":this.viewportHeight(),"width":this.viewportWidth()}},getScrollLeft:function(){return this.pageXOffset||a.documentElement.scrollLeft},getScrollTop:function(){return this.pageYOffset||a.documentElement.scrollTop},getScrollOffsets:function(){return{"left":this.getScrollLeft(),"top":this.getScrollTop()}}};Function.prototype.safeBind=function(){var e=this,g=$A(arguments),f=g.shift();return function(){if(typeof $A=="function"){return e.apply(f,g.concat($A(arguments)))}}}})(window,document,PrototypeAlias);